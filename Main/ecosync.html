<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoSync AI - Plant the Future</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:wght@400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background:#f0f0c6f4;
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Enhanced Header */
        .main-header {
            background: linear-gradient(135deg, #2d5016 0%, #2f4f1b 50%, #365421 100%);
            padding: 4rem 3rem;
            border-radius: 25px;
            color: white;
            text-align: center;
            margin-bottom: 3rem;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
            transform: translateY(0);
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .main-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: headerShimmer 4s ease-in-out infinite;
        }

        @keyframes headerShimmer {
            0%, 100% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.1); }
        }

        .main-header h1 {
            font-family: 'Playfair Display', serif;
            font-size: 4.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.4);
            position: relative;
            z-index: 2;
            letter-spacing: -2px;
        }

        .main-header h3 {
            font-size: 1.8rem;
            margin-bottom: 1rem;
            opacity: 0.95;
            font-weight: 500;
            position: relative;
            z-index: 2;
        }

        .main-header p {
            font-size: 1.2rem;
            opacity: 0.85;
            position: relative;
            z-index: 2;
            font-weight: 300;
        }

        /* Enhanced Navigation */
        .tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            margin-bottom: 3rem;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .tab-button {
            flex: 1;
            padding: 1.5rem 2rem;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            color: #666;
            position: relative;
            overflow: hidden;
        }

        .tab-button::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 3px;
            background: linear-gradient(90deg, #4a7c2a, #6ba644);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateX(-50%);
        }

        .tab-button.active {
            background: linear-gradient(135deg, #2d5016,#365421);
            color: white;
            transform: translateY(-2px);
        }

        .tab-button.active::before {
            width: 100%;
        }

        .tab-button:hover:not(.active) {
            background: rgba(106, 166, 68, 0.1);
            transform: translateY(-1px);
        }

        /* Enhanced Tab Content */
        .tab-content {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 3rem;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            min-height: 700px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .tab-content.active {
            display: block;
            animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .tab-content h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            color: #2d5016;
            margin-bottom: 2rem;
            text-align: center;
            font-weight: 600;
        }

        /* Enhanced Layout */
        .columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
            margin-top: 2rem;
        }

        .column {
            background: rgba(248, 249, 250, 0.8);
            padding: 2.5rem;
            border-radius: 20px;
            border: 1px solid rgba(233, 236, 239, 0.5);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .column:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .column h3 {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            color: #2d5016;
            margin-bottom: 1.5rem;
            font-weight: 600;
        }

        /* Enhanced Form Elements */
        .form-group {
            margin-bottom: 2rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.8rem;
            font-weight: 600;
            color: #1d320f;
            font-size: 1.1rem;
        }

        .form-group select,
        .form-group input {
            width: 100%;
            padding: 1rem 1.5rem;
            border: 2px solid rgba(45, 80, 22, 0.2);
            border-radius: 15px;
            font-size: 1rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
        }

        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: #426e26;
            box-shadow: 0 0 0 4px rgba(74, 124, 42, 0.1);
            transform: translateY(-2px);
        }

        /* Enhanced Result Cards */
        .result-card {
            background: linear-gradient(135deg, rgba(232, 245, 232, 0.9), rgba(212, 241, 212, 0.9));
            backdrop-filter: blur(15px);
            padding: 2.5rem;
            border-radius: 20px;
            border-left: 6px solid #4a7c2a;
            margin: 1.5rem 0;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .result-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }

        .result-card h3 {
            color: #2d5016;
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
        }

        .result-card h4 {
            margin: 1rem 0;
            color: #4a7c2a;
            font-size: 1.2rem;
        }

        /* Enhanced Metrics */
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 3rem 0;
        }

        .metric-card {
            background: linear-gradient(135deg, #4a7c2a, #6ba644);
            color: white;
            padding: 2.5rem;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
        }

        .metric-card:hover::before {
            animation: shimmer 1s ease-in-out;
        }

        @keyframes shimmer {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(180deg); }
        }

        .metric-card h3 {
            font-size: 3rem;
            margin-bottom: 1rem;
            font-weight: 700;
            position: relative;
            z-index: 2;
        }

        .metric-card p {
            opacity: 0.9;
            font-size: 1.2rem;
            font-weight: 500;
            position: relative;
            z-index: 2;
        }

        /* Enhanced Buttons */
        .btn {
            padding: 1.2rem 2.5rem;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            width: 100%;
            margin: 0.8rem 0;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, #2d5016, #365421);
            color: white;
            box-shadow: 0 8px 25px rgba(74, 124, 42, 0.3);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #3a5f1a, #5a9534);
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(74, 124, 42, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #868e96);
            color: white;
            box-shadow: 0 8px 25px rgba(108, 117, 125, 0.3);
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #5a6268, #74818a);
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(108, 117, 125, 0.4);
        }

        /* Enhanced Tree Selection */
        .tree-selection {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid rgba(45, 80, 22, 0.2);
            border-radius: 15px;
            padding: 1.5rem;
            margin: 1rem 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
        }

        .tree-selection:hover {
            border-color: #4a7c2a;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .tree-selection.selected {
            border-color: #4a7c2a;
            background: rgba(232, 245, 232, 0.9);
            box-shadow: 0 8px 25px rgba(74, 124, 42, 0.2);
        }

        .tree-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .tree-name {
            font-weight: 700;
            font-size: 1.3rem;
            color: #2d5016;
        }

        .tree-info {
            color: #4a7c2a;
            font-size: 1rem;
            font-weight: 500;
        }

        .tree-details {
            background: rgba(248, 249, 250, 0.8);
            padding: 1rem;
            border-radius: 10px;
            margin-top: 1rem;
            font-size: 0.9rem;
            color: #666;
        }

        .checkbox {
            width: 24px;
            height: 24px;
            margin-right: 15px;
            accent-color: #4a7c2a;
        }

        /* Enhanced Certificate */
        .certificate {
            background: linear-gradient(135deg, #2d5016 0%, #4a7c2a 25%, #6ba644 75%, #8bc34a 100%);
            padding: 4rem 3rem;
            border-radius: 25px;
            color: white;
            text-align: center;
            border: 6px solid #FFD700;
            margin: 2rem 0;
            box-shadow: 0 25px 50px rgba(0,0,0,0.4);
            position: relative;
            overflow: hidden;
        }

        .certificate::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(transparent, rgba(255,255,255,0.1), transparent);
            animation: certificateRotate 8s linear infinite;
        }

        @keyframes certificateRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .certificate-header {
            position: relative;
            z-index: 2;
            margin-bottom: 2rem;
        }

        .certificate h3 {
            font-family: 'Playfair Display', serif;
            font-size: 2.8rem;
            margin-bottom: 1rem;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.4);
            font-weight: 700;
            letter-spacing: 2px;
            position: relative;
            z-index: 2;
        }

        .certificate h4 {
            font-size: 1.4rem;
            opacity: 0.9;
            margin-bottom: 2rem;
            font-family: 'Courier New', monospace;
            background: rgba(255,255,255,0.15);
            padding: 0.8rem 1.5rem;
            border-radius: 25px;
            display: inline-block;
            position: relative;
            z-index: 2;
        }

        .certificate h2 {
            font-size: 4.5rem;
            margin: 2rem 0;
            text-shadow: 4px 4px 8px rgba(0,0,0,0.5);
            font-weight: 800;
            position: relative;
            z-index: 2;
        }

        .certificate p {
            font-size: 1.3rem;
            margin: 1rem 0;
            position: relative;
            z-index: 2;
        }

        /* Enhanced Map */
        .map-container {
            height: 500px;
            border-radius: 20px;
            overflow: hidden;
            margin: 2rem 0;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            border: 3px solid rgba(255, 255, 255, 0.3);
        }

        /* Enhanced Alerts */
        .alert {
            padding: 1.5rem;
            border-radius: 15px;
            margin: 1.5rem 0;
            font-weight: 500;
            backdrop-filter: blur(10px);
        }

        .alert-success {
            background: rgba(212, 237, 218, 0.9);
            color: #155724;
            border: 2px solid rgba(21, 87, 36, 0.2);
        }

        .alert-info {
            background: rgba(204, 231, 255, 0.9);
            color: #004085;
            border: 2px solid rgba(0, 64, 133, 0.2);
        }
        /* Enhanced Footer */
        .footer {
            text-align: center;
            padding: 3rem;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 4rem;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }

        .footer p {
            margin: 0.5rem 0;
            font-size: 1.1rem;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            
            .columns {
                grid-template-columns: 1fr;
            }
            
            .main-header h1 {
                font-size: 3rem;
            }

            .certificate h2 {
                font-size: 3rem;
            }

            .tab-content {
                padding: 2rem;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(74, 124, 42, 0.3);
            border-radius: 50%;
            border-top-color: #4a7c2a;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Achievement Badges */
        .achievement-badge {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #333;
            padding: 1rem;
            border-radius: 15px;
            text-align: center;
            min-width: 140px;
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .achievement-badge:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 35px rgba(255, 215, 0, 0.4);
        }

        .achievement-badge.locked {
            background: #f0f0f0;
            color: #999;
            transform: scale(0.9);
            opacity: 0.6;
        }

        /* Enhanced Tree Species Cards */
        .species-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .species-detail {
            background: rgba(255, 255, 255, 0.8);
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
            border: 1px solid rgba(74, 124, 42, 0.2);
        }

        .species-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        /* Floating Action Buttons */
        .fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4a7c2a, #6ba644);
            color: white;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(74, 124, 42, 0.4);
            transition: all 0.3s ease;
            z-index: 1001;
        }

        .fab:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 35px rgba(74, 124, 42, 0.5);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="main-header">
            <h1><i class="fas fa-seedling"></i> EcoSync AI</h1>
            <h3>Plant the Future. Offset the Past.</h3>
            <p>Tree Planting for Sustainable Tourism</p>
        </div>

        <!-- Navigation Tabs -->
        <div class="tabs">
            <button class="tab-button active" onclick="openTab(event, 'calculate')">
                <i class="fas fa-calculator"></i> Calculate Emissions
            </button>
            <button class="tab-button" onclick="openTab(event, 'plant')">
                <i class="fas fa-tree"></i> Plant Trees
            </button>
            <button class="tab-button" onclick="openTab(event, 'track')">
                <i class="fas fa-chart-line"></i> Track Impact
            </button>
            <button class="tab-button" onclick="openTab(event, 'certificates')">
                <i class="fas fa-certificate"></i> My Certificates
            </button>
        </div>

        <!-- Tab Content -->
        <div id="calculate" class="tab-content active">
            <h2><i class="fas fa-calculator"></i> Calculate Your Travel Emissions</h2>
            
            <div class="columns">
                <div class="column">
                    <h3>Travel Details</h3>
                    
                    <div class="form-group">
                        <label for="transport">Transport Mode</label>
                        <select id="transport">
                            <option value="Flight (Domestic)">Flight (Domestic)</option>
                            <option value="Flight (International)">Flight (International)</option>
                            <option value="Car (Petrol)">Car (Petrol)</option>
                            <option value="Car (Electric)">Car (Electric)</option>
                            <option value="Train">Train</option>
                            <option value="Bus">Bus</option>
                            <option value="Motorcycle">Motorcycle</option>
                            <option value="Cruise Ship">Cruise Ship</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="distance">Distance (km)</label>
                        <input type="number" id="distance" value="500" min="0" step="50">
                    </div>
                    
                    <div class="form-group">
                        <label for="duration">Stay Duration (days)</label>
                        <input type="number" id="duration" value="5" min="1">
                    </div>
                    
                    <div class="form-group">
                        <label for="people">Number of People</label>
                        <input type="number" id="people" value="2" min="1">
                    </div>
                    
                    <div class="form-group">
                        <label for="accommodation">Accommodation</label>
                        <select id="accommodation">
                            <option value="Luxury Hotel">Luxury Hotel</option>
                            <option value="Standard Hotel">Standard Hotel</option>
                            <option value="Budget Hotel">Budget Hotel</option>
                            <option value="Eco-Lodge">Eco-Lodge</option>
                            <option value="Hostel">Hostel</option>
                            <option value="Camping">Camping</option>
                        </select>
                    </div>
                </div>
                
                <div class="column">
                    <h3>Emission Calculation</h3>
                    
                    <div class="result-card" id="emissions-result">
                        <h4 id="transport-emissions">Transport: 0 kg CO2</h4>
                        <h4 id="accommodation-emissions">Accommodation: 0 kg CO2</h4>
                        <hr style="margin: 1rem 0; border: 1px solid rgba(74, 124, 42, 0.3);">
                        <h3 id="total-emissions">Total Emissions: 0 kg CO2</h3>
                    </div>
                    
                    <button class="btn btn-primary" onclick="calculateEmissions()">
                        <i class="fas fa-calculator"></i> Calculate Trees Needed
                    </button>
                    
                    <div id="calculation-alert" class="alert alert-success" style="display: none;">
                        <i class="fas fa-check-circle"></i> Calculation complete! Go to 'Plant Trees' tab to start planting!
                    </div>
                </div>
            </div>
        </div>

        <div id="plant" class="tab-content">
            <h2><i class="fas fa-tree"></i> Plant Trees to Offset Your Emissions</h2>
            
            <div id="emissions-display" class="alert alert-info" style="display: none;">
                <i class="fas fa-info-circle"></i> <span id="emissions-text"></span>
            </div>
            
            <div class="form-group">
                <label for="manual-emissions">CO2 to Offset (kg)</label>
                <input type="number" id="manual-emissions" value="100" min="0" step="10">
            </div>
            
            <div class="columns">
                <div class="column">
                    <h3>Choose Your Region</h3>
                    
                    <div class="form-group">
                        <label for="region">Climate Region</label>
                        <select id="region" onchange="filterTrees()">
                            <option value="Tropical">Tropical (Hot & Humid)</option>
                            <option value="Temperate">Temperate (Moderate Climate)</option>
                            <option value="Arid">Arid (Dry & Hot)</option>
                            <option value="Cold">Cold (Northern Regions)</option>
                            <option value="Mediterranean">Mediterranean (Warm & Dry)</option>
                            <option value="Subtropical">Subtropical (Warm & Wet)</option>
                            <option value="Continental">Continental (Hot Summer, Cold Winter)</option>
                        </select>
                    </div>
                    
                    <h3>Recommended Trees</h3>
                    <div id="tree-selection"></div>
                </div>
                
                <div class="column">
                    <h3>Planting Summary</h3>
                    
                    <div class="result-card" id="planting-summary" style="display: none;">
                        <h3>Your Tree Planting Plan</h3>
                        <p><strong>Total Trees:</strong> <span id="summary-trees">0</span></p>
                        <p><strong>Total Cost:</strong> $<span id="summary-cost">0</span></p>
                        <p><strong>CO2 Offset:</strong> <span id="summary-co2">0</span> kg</p>
                        <p><strong>Environmental Impact:</strong> <span id="summary-impact">0</span> sq meters coverage</p>
                    </div>
                    
                    <div id="planting-options" style="display: none;">
                        <h3>Planting Options</h3>
                        <div class="form-group">
                            <label>How would you like to plant?</label>
                            <select id="planting-method">
                                <option value="Plant yourself">Plant yourself</option>
                                <option value="Sponsor local farmers">Sponsor local farmers</option>
                                <option value="Support school programs">Support school programs</option>
                                <option value="Partner with NGOs">Partner with NGOs</option>
                                <option value="Corporate partnership">Corporate partnership</option>
                                <option value="Community initiative">Community initiative</option>
                            </select>
                        </div>
                        
                        <h3>Complete Your Order</h3>
                        <div class="form-group">
                            <label for="payment-method">Payment Method</label>
                            <select id="payment-method">
                                <option value = "Plant Yourself - Zero Cost">Plant Yourself - Zero Cost</option>
                                <option value="Credit Card">Credit Card</option>
                                <option value="PayPal">PayPal</option>
                                <option value="Bank Transfer">Bank Transfer</option>
                                <option value="Crypto">Cryptocurrency</option>
                                <option value="Apple Pay"> Pay</option>
                                <option value="Google Pay">Google Pay</option>
                            </select>
                        </div>
                        
                        <button class="btn btn-primary" onclick="plantTrees()">
                            <i class="fas fa-seedling"></i> PLANT TREES NOW
                        </button>
                    </div>
                    
                    <div id="quick-plant">
                        <h3>Quick Plant Option</h3>
                        <p>Don't want to choose? Let AI pick the best mix for you.</p>
                        <button class="btn btn-secondary" onclick="autoSelectTrees()">
                            <i class="fas fa-magic"></i> AUTO-SELECT BEST TREES
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="track" class="tab-content">
            <h2><i class="fas fa-chart-line"></i> Track Your Environmental Impact</h2>
            
            <div class="metric-grid">
                <div class="metric-card">
                    <h3 id="metric-trees">0</h3>
                    <p>Trees Planted</p>
                </div>
                <div class="metric-card">
                    <h3 id="metric-co2">0 kg</h3>
                    <p>CO2 Offset</p>
                </div>
                <div class="metric-card">
                    <h3 id="metric-certificates">0</h3>
                    <p>Certificates</p>
                </div>
                <div class="metric-card">
                    <h3 id="metric-impact">0 m²</h3>
                    <p>Forest Coverage</p>
                </div>
            </div>
            
            <div id="tracking-content">
                <h3><i class="fas fa-map-marker-alt"></i> Your Tree Locations</h3>
                <div id="map" class="map-container"></div>
                                
                
                <!-- Impact Statistics -->
                <div style="background: linear-gradient(135deg, rgba(248, 249, 250, 0.9), rgba(233, 236, 239, 0.9)); backdrop-filter: blur(15px); padding: 3rem; border-radius: 25px; margin: 2rem 0; box-shadow: 0 15px 35px rgba(0,0,0,0.1);">
                    <h3 style="color: #2d5016; margin-bottom: 2rem; text-align: center; font-size: 2rem;">
                        <i class="fas fa-leaf"></i> Environmental Impact Summary
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div style="text-align: center; padding: 1.5rem; background: rgba(255, 255, 255, 0.8); border-radius: 15px; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                            <div style="font-size: 3rem; color: #4a7c2a; margin-bottom: 1rem;">🌳</div>
                            <h4 style="color: #2d5016; margin-bottom: 1rem; font-size: 1.2rem;">Forest Coverage</h4>
                            <p style="color: #666; font-size: 1rem; font-weight: 500;" id="forest-coverage">0 sq meters created</p>
                        </div>
                        <div style="text-align: center; padding: 1.5rem; background: rgba(255, 255, 255, 0.8); border-radius: 15px; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                            <div style="font-size: 3rem; color: #4a7c2a; margin-bottom: 1rem;">💨</div>
                            <h4 style="color: #2d5016; margin-bottom: 1rem; font-size: 1.2rem;">Air Purification</h4>
                            <p style="color: #666; font-size: 1rem; font-weight: 500;" id="air-purification">0 kg air cleaned yearly</p>
                        </div>
                        <div style="text-align: center; padding: 1.5rem; background: rgba(255, 255, 255, 0.8); border-radius: 15px; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                            <div style="font-size: 3rem; color: #4a7c2a; margin-bottom: 1rem;">🐦</div>
                            <h4 style="color: #2d5016; margin-bottom: 1rem; font-size: 1.2rem;">Wildlife Habitat</h4>
                            <p style="color: #666; font-size: 1rem; font-weight: 500;" id="wildlife-habitat">0 birds supported</p>
                        </div>
                        <div style="text-align: center; padding: 1.5rem; background: rgba(255, 255, 255, 0.8); border-radius: 15px; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                            <div style="font-size: 3rem; color: #4a7c2a; margin-bottom: 1rem;">💧</div>
                            <h4 style="color: #2d5016; margin-bottom: 1rem; font-size: 1.2rem;">Water Conservation</h4>
                            <p style="color: #666; font-size: 1rem; font-weight: 500;" id="water-conservation">0 liters saved yearly</p>
                        </div>
                    </div>
                </div>
                
                <!-- Achievement Badges -->
                <div id="achievement-badges" style="margin-top: 3rem;">
                    <h3 style="color: #2d5016; margin-bottom: 2rem; text-align: center; font-size: 2rem;">
                        <i class="fas fa-trophy"></i> Environmental Achievements
                    </h3>
                    <div id="badges-container" style="display: flex; flex-wrap: wrap; gap: 1.5rem; justify-content: center;">
                        <!-- Badges will be populated by JavaScript -->
                    </div>
                </div>
            </div>
            
            <div id="no-trees-message" class="alert alert-info">
                <i class="fas fa-info-circle"></i> Start planting trees to track your impact and see detailed analytics!
            </div>
        </div>

        <div id="certificates" class="tab-content">
            <h2><i class="fas fa-certificate"></i> My Certificates</h2>
            
            <div id="certificates-list"></div>
            
            <div id="no-certificates-message" class="alert alert-info">
                <i class="fas fa-info-circle"></i> No certificates yet! Plant some trees to earn your first certificate.
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p><strong>EcoSync AI</strong> - Making carbon neutrality simple and accessible</p>
            <p>Powered by EthnoTech</p>
        </div>
    </div>

    <!-- Floating Action Button -->
    <button class="fab" onclick="scrollToTop()" title="Back to Top">
        <i class="fas fa-arrow-up"></i>
    </button>

    <script>
        // Mapbox API Key
        const MAPBOX_API_KEY = 'pk.eyJ1IjoiYXNtaTExMSIsImEiOiJjbWRqMXBheWcwaGhkMm1xMGJ5dGg1dWdjIn0.oyjl1Vwdx2HOQuCdfqyW7Q';
        
        // Application State
        let appState = {
            userData: {
                totalEmissions: 0,
                treesPlanted: 0,
                certificates: [],
                forestArea: 0,
                totalCO2Offset: 0
            },
            calculatedEmissions: 0,
            selectedTrees: {}
        };

        // Enhanced tree species data
        const treeSpeciesData = {
            // Tropical Climate Trees
            "Mango": { co2PerYear: 60, cost: 30, region: "Tropical", growthRate: "Fast", waterNeed: "High", icon: "🥭", description: "Fruit-bearing, excellent carbon absorption" },
            "Banyan": { co2PerYear: 90, cost: 40, region: "Tropical", growthRate: "Medium", waterNeed: "Medium", icon: "🌳", description: "Massive canopy, wildlife habitat" },
            "Teak": { co2PerYear: 55, cost: 45, region: "Tropical", growthRate: "Medium", waterNeed: "Medium", icon: "🌲", description: "Valuable hardwood, long-lasting" },
            "Mahogany": { co2PerYear: 65, cost: 50, region: "Tropical", growthRate: "Slow", waterNeed: "Medium", icon: "🌳", description: "Premium timber, high CO2 absorption" },
            "Bamboo": { co2PerYear: 85, cost: 15, region: "Tropical", growthRate: "Very Fast", waterNeed: "High", icon: "🎋", description: "Fastest growing, renewable resource" },
            
            // Temperate Climate Trees  
            "Oak": { co2PerYear: 48, cost: 25, region: "Temperate", growthRate: "Slow", waterNeed: "Medium", icon: "🌳", description: "Longevity champion, wildlife support" },
            "Maple": { co2PerYear: 42, cost: 28, region: "Temperate", growthRate: "Medium", waterNeed: "Medium", icon: "🍁", description: "Beautiful foliage, syrup production" },
            "Birch": { co2PerYear: 35, cost: 20, region: "Temperate", growthRate: "Fast", waterNeed: "High", icon: "🌳", description: "Pioneer species, soil improvement" },
            "Beech": { co2PerYear: 45, cost: 32, region: "Temperate", growthRate: "Medium", waterNeed: "Medium", icon: "🌳", description: "Dense wood, excellent carbon storage" },
            
            // Cold Climate Trees
            "Pine": { co2PerYear: 35, cost: 15, region: "Cold", growthRate: "Medium", waterNeed: "Low", icon: "🌲", description: "Evergreen, cold resistant" },
            "Spruce": { co2PerYear: 38, cost: 18, region: "Cold", growthRate: "Medium", waterNeed: "Low", icon: "🌲", description: "Tall growth, paper production" },
            "Fir": { co2PerYear: 40, cost: 22, region: "Cold", growthRate: "Slow", waterNeed: "Low", icon: "🌲", description: "Christmas tree, aromatic" },
            "Larch": { co2PerYear: 36, cost: 19, region: "Cold", growthRate: "Fast", waterNeed: "Medium", icon: "🌲", description: "Deciduous conifer, hardy" },
            
            // Arid Climate Trees
            "Neem": { co2PerYear: 45, cost: 20, region: "Arid", growthRate: "Fast", waterNeed: "Low", icon: "🌿", description: "Medicinal properties, pest resistant" },
            "Acacia": { co2PerYear: 38, cost: 18, region: "Arid", growthRate: "Fast", waterNeed: "Very Low", icon: "🌳", description: "Drought tolerant, nitrogen fixing" },
            "Desert Willow": { co2PerYear: 25, cost: 15, region: "Arid", growthRate: "Medium", waterNeed: "Very Low", icon: "🌳", description: "Beautiful flowers, minimal water" },
            "Palo Verde": { co2PerYear: 30, cost: 25, region: "Arid", growthRate: "Medium", waterNeed: "Very Low", icon: "🌳", description: "Green bark, desert adaptation" },
            
            // Mediterranean Climate Trees
            "Olive": { co2PerYear: 32, cost: 35, region: "Mediterranean", growthRate: "Slow", waterNeed: "Low", icon: "🫒", description: "Fruit production, ancient heritage" },
            "Cork Oak": { co2PerYear: 42, cost: 30, region: "Mediterranean", growthRate: "Slow", waterNeed: "Low", icon: "🌳", description: "Cork production, fire resistant" },
            "Eucalyptus": { co2PerYear: 52, cost: 22, region: "Mediterranean", growthRate: "Very Fast", waterNeed: "Medium", icon: "🌳", description: "Fast growth, oil production" },
            
            // Subtropical Climate Trees
            "Avocado": { co2PerYear: 38, cost: 40, region: "Subtropical", growthRate: "Medium", waterNeed: "High", icon: "🥑", description: "Nutritious fruit, steady growth" },
            "Citrus": { co2PerYear: 35, cost: 32, region: "Subtropical", growthRate: "Medium", waterNeed: "High", icon: "🍊", description: "Vitamin C source, fragrant" },
            "Jacaranda": { co2PerYear: 40, cost: 28, region: "Subtropical", growthRate: "Medium", waterNeed: "Medium", icon: "💜", description: "Purple flowers, ornamental" },
            
            // Continental Climate Trees
            "Poplar": { co2PerYear: 50, cost: 16, region: "Continental", growthRate: "Very Fast", waterNeed: "High", icon: "🌳", description: "Rapid growth, biomass production" },
            "Willow": { co2PerYear: 45, cost: 14, region: "Continental", growthRate: "Very Fast", waterNeed: "Very High", icon: "🌳", description: "Water loving, flexible wood" },
            "Ash": { co2PerYear: 43, cost: 26, region: "Continental", growthRate: "Fast", waterNeed: "Medium", icon: "🌳", description: "Strong wood, tool making" }
        };

        // Enhanced emission factors
        const emissionFactors = {
            "Flight (Domestic)": 0.255,
            "Flight (International)": 0.195,
            "Car (Petrol)": 0.171,
            "Car (Electric)": 0.053,
            "Train": 0.041,
            "Bus": 0.089,
            "Motorcycle": 0.095,
            "Cruise Ship": 0.285
        };

        const accommodationFactors = {
            "Luxury Hotel": 45,
            "Standard Hotel": 30,
            "Budget Hotel": 20,
            "Eco-Lodge": 15,
            "Hostel": 12,
            "Camping": 5
        };

        // Tab functionality with proper tracking update
        function openTab(evt, tabName) {
            const tabContents = document.getElementsByClassName("tab-content");
            const tabButtons = document.getElementsByClassName("tab-button");
            
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove("active");
            }
            
            for (let i = 0; i < tabButtons.length; i++) {
                tabButtons[i].classList.remove("active");
            }
            
            document.getElementById(tabName).classList.add("active");
            evt.currentTarget.classList.add("active");
            
            // Update tracking when switching to track tab
            if (tabName === 'track') {
                setTimeout(() => {
                    updateAllMetrics();
                    updateTracking();
                }, 300);
            }
        }

        // Enhanced calculate emissions
        function calculateEmissions() {
            const transport = document.getElementById('transport').value;
            const distance = parseFloat(document.getElementById('distance').value) || 0;
            const duration = parseInt(document.getElementById('duration').value) || 0;
            const people = parseInt(document.getElementById('people').value) || 1;
            const accommodation = document.getElementById('accommodation').value;

            const transportEmissions = distance * (emissionFactors[transport] || 0.2) * people;
            const accommodationEmissions = duration * (accommodationFactors[accommodation] || 30) * people;
            const totalEmissions = transportEmissions + accommodationEmissions;

            // Add smooth number animation
            animateNumber('transport-emissions', 0, transportEmissions, 'Transport: ', ' kg CO2');
            animateNumber('accommodation-emissions', 0, accommodationEmissions, 'Accommodation: ', ' kg CO2');
            animateNumber('total-emissions', 0, totalEmissions, 'Total Emissions: ', ' kg CO2');

            appState.calculatedEmissions = totalEmissions;
            appState.userData.totalEmissions = totalEmissions;

            document.getElementById('calculation-alert').style.display = 'block';
            document.getElementById('emissions-display').style.display = 'block';
            document.getElementById('emissions-text').textContent = `Offsetting: ${totalEmissions.toFixed(1)} kg CO2 from your calculation`;
            document.getElementById('manual-emissions').value = totalEmissions.toFixed(1);

            filterTrees();
        }

        // Animate numbers for better UX
        function animateNumber(elementId, start, end, prefix = '', suffix = '') {
            const element = document.getElementById(elementId);
            const duration = 1000;
            const startTime = performance.now();
            
            function updateNumber(currentTime) {
                const elapsedTime = currentTime - startTime;
                const progress = Math.min(elapsedTime / duration, 1);
                const current = start + (end - start) * easeOutCubic(progress);
                element.textContent = prefix + current.toFixed(1) + suffix;
                
                if (progress < 1) {
                    requestAnimationFrame(updateNumber);
                }
            }
            
            requestAnimationFrame(updateNumber);
        }

        function easeOutCubic(t) {
            return 1 - Math.pow(1 - t, 3);
        }

        // Enhanced filter trees
        function filterTrees() {
            const region = document.getElementById('region').value;
            const container = document.getElementById('tree-selection');
            container.innerHTML = '';

            Object.entries(treeSpeciesData).forEach(([treeName, data]) => {
                if (region === data.region || region === 'All') {
                    const emissionsToOffset = parseFloat(document.getElementById('manual-emissions').value) || 100;
                    const treesNeeded = Math.max(1, Math.ceil(emissionsToOffset / data.co2PerYear));
                    const cost = treesNeeded * data.cost;

                    const treeDiv = document.createElement('div');
                    treeDiv.className = 'tree-selection';
                    treeDiv.innerHTML = `
                        <div class="tree-header">
                            <div>
                                <div class="tree-name">${data.icon} ${treeName}</div>
                                <div class="tree-info">Trees needed: ${treesNeeded} | Cost: ${cost}</div>
                            </div>
                            <input type="checkbox" class="checkbox" onchange="selectTree('${treeName}', this.checked)">
                        </div>
                        <div class="tree-details">
                            <div class="species-details">
                                <div class="species-detail">
                                    <div class="species-icon">📈</div>
                                    <strong>Growth</strong><br>${data.growthRate}
                                </div>
                                <div class="species-detail">
                                    <div class="species-icon">💧</div>
                                    <strong>Water</strong><br>${data.waterNeed}
                                </div>
                                <div class="species-detail">
                                    <div class="species-icon">🌱</div>
                                    <strong>CO2/Year</strong><br>${data.co2PerYear} kg
                                </div>
                            </div>
                            <p style="margin-top: 1rem; font-style: italic;">${data.description}</p>
                        </div>
                        <div id="quantity-${treeName}" style="display: none; margin-top: 1rem;">
                            <label>Quantity:</label>
                            <input type="number" id="qty-${treeName}" value="${treesNeeded}" min="1" onchange="updateTreeQuantity('${treeName}')" style="width: 100px; margin-left: 10px;">
                        </div>
                    `;
                    container.appendChild(treeDiv);
                }
            });
        }

        // Enhanced tree selection
        function selectTree(treeName, isSelected) {
            const quantityDiv = document.getElementById(`quantity-${treeName}`);
            const treeDiv = quantityDiv.parentElement;
            
            if (isSelected) {
                appState.selectedTrees[treeName] = parseInt(document.getElementById(`qty-${treeName}`).value);
                quantityDiv.style.display = 'block';
                treeDiv.classList.add('selected');
            } else {
                delete appState.selectedTrees[treeName];
                quantityDiv.style.display = 'none';
                treeDiv.classList.remove('selected');
            }
            
            updatePlantingSummary();
        }

        function updateTreeQuantity(treeName) {
            const quantity = parseInt(document.getElementById(`qty-${treeName}`).value) || 1;
            appState.selectedTrees[treeName] = quantity;
            updatePlantingSummary();
        }

        // Enhanced planting summary
        function updatePlantingSummary() {
            let totalTrees = 0;
            let totalCost = 0;
            let totalCO2 = 0;
            const emissionsToOffset = parseFloat(document.getElementById('manual-emissions').value) || 100;

            Object.entries(appState.selectedTrees).forEach(([treeName, quantity]) => {
                const treeData = treeSpeciesData[treeName];
                totalTrees += quantity;
                totalCost += quantity * treeData.cost;
                totalCO2 += quantity * treeData.co2PerYear;
            });

            if (totalTrees > 0) {
                document.getElementById('planting-summary').style.display = 'block';
                document.getElementById('planting-options').style.display = 'block';
                document.getElementById('summary-trees').textContent = totalTrees;
                document.getElementById('summary-cost').textContent = totalCost;
                document.getElementById('summary-co2').textContent = Math.min(totalCO2, emissionsToOffset).toFixed(1);
                document.getElementById('summary-impact').textContent = (totalTrees * 15).toFixed(1);
            } else {
                document.getElementById('planting-summary').style.display = 'none';
                document.getElementById('planting-options').style.display = 'none';
            }
        }

        // Enhanced tree planting with proper state update
        function plantTrees() {
            showPlantingProgress();
            
            setTimeout(() => {
                let totalTrees = 0;
                let totalCost = 0;
                let totalCO2Offset = 0;
                const emissionsToOffset = parseFloat(document.getElementById('manual-emissions').value) || 100;
                const species = Object.keys(appState.selectedTrees);

                Object.entries(appState.selectedTrees).forEach(([treeName, quantity]) => {
                    const treeData = treeSpeciesData[treeName];
                    totalTrees += quantity;
                    totalCost += quantity * treeData.cost;
                    totalCO2Offset += quantity * treeData.co2PerYear;
                });

                // Update app state properly
                appState.userData.treesPlanted += totalTrees;
                appState.userData.forestArea += totalTrees * 15;
                appState.userData.totalCO2Offset += Math.min(totalCO2Offset, emissionsToOffset);

                const certificate = {
                    date: new Date().toISOString().split('T')[0],
                    trees: totalTrees,
                    co2Offset: Math.min(totalCO2Offset, emissionsToOffset),
                    cost: totalCost,
                    species: species,
                    method: document.getElementById('planting-method').value,
                    payment: document.getElementById('payment-method').value,
                    id: Date.now()
                };

                appState.userData.certificates.push(certificate);

                showAlert('success', `🎉 Success! ${totalTrees} trees committed for planting!`);
                showAlert('info', 'Certificate generated! Check "My Certificates" tab.');
                
                animateTreePlanting();
                updateCertificates();
                updateAllMetrics();

                // Reset selection
                appState.selectedTrees = {};
                filterTrees();
                updatePlantingSummary();
            }, 2500);
        }

        // Enhanced auto select trees
        function autoSelectTrees() {
            const region = document.getElementById('region').value;
            const emissionsToOffset = parseFloat(document.getElementById('manual-emissions').value) || 100;
            
            const suitableTrees = Object.entries(treeSpeciesData).filter(([name, data]) => 
                data.region === region
            );
            
            if (suitableTrees.length === 0) return;
            
            // Select best trees based on CO2 absorption and cost efficiency
            const bestTrees = suitableTrees
                .sort((a, b) => (b[1].co2PerYear / b[1].cost) - (a[1].co2PerYear / a[1].cost))
                .slice(0, 3);
            
            let remainingOffset = emissionsToOffset;
            let totalTrees = 0;
            let totalCost = 0;
            let totalCO2Offset = 0;
            const selectedSpecies = [];
            
            bestTrees.forEach(([treeName, treeData]) => {
                if (remainingOffset > 0) {
                    const treesNeeded = Math.min(
                        Math.ceil(remainingOffset / treeData.co2PerYear),
                        Math.ceil(emissionsToOffset * 0.4 / treeData.co2PerYear)
                    );
                    totalTrees += treesNeeded;
                    totalCost += treesNeeded * treeData.cost;
                    totalCO2Offset += treesNeeded * treeData.co2PerYear;
                    remainingOffset -= treesNeeded * treeData.co2PerYear;
                    selectedSpecies.push(treeName);
                }
            });

            // Update app state properly
            appState.userData.treesPlanted += totalTrees;
            appState.userData.forestArea += totalTrees * 15;
            appState.userData.totalCO2Offset += Math.min(totalCO2Offset, emissionsToOffset);

            const certificate = {
                date: new Date().toISOString().split('T')[0],
                trees: totalTrees,
                co2Offset: Math.min(totalCO2Offset, emissionsToOffset),
                cost: totalCost,
                species: selectedSpecies,
                method: "AI Auto-Selection",
                payment: "Auto-Processing",
                id: Date.now()
            };

            appState.userData.certificates.push(certificate);

            showAlert('success', `🤖 AI Auto-planted! ${totalTrees} trees from ${selectedSpecies.length} species committed!`);
            
            animateTreePlanting();
            updateCertificates();
            updateAllMetrics();
        }

        // Fixed: Update all metrics properly
        function updateAllMetrics() {
            // Update main metric cards
            document.getElementById('metric-trees').textContent = appState.userData.treesPlanted;
            document.getElementById('metric-co2').textContent = `${appState.userData.totalCO2Offset.toFixed(0)} kg`;
            document.getElementById('metric-certificates').textContent = appState.userData.certificates.length;
            document.getElementById('metric-impact').textContent = `${appState.userData.forestArea.toFixed(0)} m²`;

            // Update impact statistics
            updateImpactStats();
        }

        // Fixed: Update impact statistics
        function updateImpactStats() {
            const trees = appState.userData.treesPlanted;
            
            if (trees > 0) {
                const forestCoverage = (trees * 15).toFixed(1);
                const airPurification = (trees * 22).toFixed(0);
                const wildlifeHabitat = Math.floor(trees / 3);
                const waterConservation = (trees * 150).toFixed(0);
                
                document.getElementById('forest-coverage').textContent = `${forestCoverage} sq meters created`;
                document.getElementById('air-purification').textContent = `${airPurification} kg air cleaned yearly`;
                document.getElementById('wildlife-habitat').textContent = `${wildlifeHabitat} birds supported`;
                document.getElementById('water-conservation').textContent = `${waterConservation} liters saved yearly`;
            } else {
                document.getElementById('forest-coverage').textContent = '0 sq meters created';
                document.getElementById('air-purification').textContent = '0 kg air cleaned yearly';
                document.getElementById('wildlife-habitat').textContent = '0 birds supported';
                document.getElementById('water-conservation').textContent = '0 liters saved yearly';
            }
        }

        // Enhanced certificate display with landscape format
        function updateCertificates() {
            const container = document.getElementById('certificates-list');
            const noMessage = document.getElementById('no-certificates-message');
            
            if (appState.userData.certificates.length === 0) {
                container.innerHTML = '';
                noMessage.style.display = 'block';
                return;
            }
            
            noMessage.style.display = 'none';
            container.innerHTML = '';
            
            appState.userData.certificates.forEach((cert, index) => {
                const certDiv = document.createElement('div');
                certDiv.style.cssText = `
                    display: grid;
                    grid-template-columns: 2fr 1fr;
                    gap: 2rem;
                    margin-bottom: 3rem;
                    padding: 2rem;
                    background: rgba(255, 255, 255, 0.95);
                    border-radius: 25px;
                    box-shadow: 0 15px 35px rgba(0,0,0,0.1);
                    backdrop-filter: blur(15px);
                    border: 1px solid rgba(255, 255, 255, 0.3);
                `;
                
                certDiv.innerHTML = `
                    <div class="certificate" style="width: 100%; aspect-ratio: 1.4/1; padding: 2rem;">
                        <div class="certificate-header">
                            <h3 style="font-size: 2rem;"><i class="fas fa-certificate"></i> CERTIFICATE OF APPRECIATION</h3>
                            <div style="font-size: 1rem; margin: 0.5rem 0; font-style: italic;">This is to certify that,</div>
                            <div style="font-size: 2rem; font-weight: bold; margin: 0.5rem 0; color: #FFD700;">Thank You!!</div>
                            <div style="font-size: 0.9rem; margin: 0.5rem 0;">You have contributed to environmental sustainability by planting</div>
                            <h2 style="font-size: 3rem; margin: 1rem 0;">${cert.trees} Trees</h2>
                            <div style="font-size: 1.5rem; color: #90EE90; margin: 0.5rem 0;">${Math.round(cert.co2Offset)} kg CO2 Offset</div>
                            <div style="font-size: 0.9rem; margin: 1rem 0;">Thank you for sowing the seeds of a greener tomorrow.</div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 1rem;">
                            <div style="text-align: left;">
                                <div style="border-bottom: 2px solid #FFD700; padding-bottom: 0.3rem; margin-bottom: 0.3rem; width: 100px; font-size: 0.8rem;">EcoSync AI</div>
                                <div style="font-size: 0.7rem;">Platform</div>
                            </div>
                            <div style="background: #FFD700; color: #333; padding: 0.5rem; border-radius: 50%; font-size: 1rem;">
                                <i class="fas fa-medal"></i>
                            </div>
                            <div style="text-align: right;">
                                <div style="border-bottom: 2px solid #FFD700; padding-bottom: 0.3rem; margin-bottom: 0.3rem; width: 80px; font-size: 0.8rem;">Verified</div>
                                <div style="font-size: 0.7rem;">Authority</div>
                            </div>
                        </div>
                        <div style="text-align: center; margin-top: 1rem;">
                            <div style="font-size: 0.8rem;">Issued: ${new Date(cert.date).toLocaleDateString()}</div>
                            <div style="font-size: 0.7rem; opacity: 0.8;">Certificate #${String(cert.id).slice(-6)}</div>
                        </div>
                    </div>
                    <div style="padding: 1rem;">
                        <h3 style="color: #2d5016; margin-bottom: 1.5rem; font-size: 1.5rem;">Certificate Details</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin: 1.5rem 0;">
                            <div class="metric-card" style="font-size: 0.8rem; padding: 1rem;">
                                <h3 style="font-size: 1.5rem;">${cert.trees}</h3>
                                <p>Trees Planted</p>
                            </div>
                            <div class="metric-card" style="font-size: 0.8rem; padding: 1rem;">
                                <h3 style="font-size: 1.5rem;">${Math.round(cert.co2Offset)} kg</h3>
                                <p>CO2 Offset</p>
                            </div>
                            <div class="metric-card" style="font-size: 0.8rem; padding: 1rem;">
                                <h3 style="font-size: 1.5rem;">${cert.cost}</h3>
                                <p>Investment</p>
                            </div>
                            <div class="metric-card" style="font-size: 0.8rem; padding: 1rem;">
                                <h3 style="font-size: 1.5rem;">${cert.species.length}</h3>
                                <p>Species</p>
                            </div>
                        </div>
                        <div style="background: rgba(248, 249, 250, 0.8); padding: 1.5rem; border-radius: 15px; margin: 1rem 0;">
                            <p><strong>Species:</strong> ${cert.species.join(', ')}</p>
                            <p><strong>Planting Method:</strong> ${cert.method}</p>
                            <p><strong>Forest Coverage:</strong> ${(cert.trees * 15).toFixed(1)} m²</p>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 2rem;">
                            <button class="btn btn-primary" onclick="downloadCertificatePDF(${index})" style="padding: 1rem; font-size: 0.9rem;">
                                <i class="fas fa-download"></i> Download PDF
                            </button>
                            <button class="btn btn-secondary" onclick="shareToSocial('twitter', ${index})" style="padding: 1rem; font-size: 0.9rem;">
                                <i class="fas fa-share"></i> Share Certificate
                            </button>
                        </div>
                    </div>
                `;
                
                container.appendChild(certDiv);
            });
        }

        // Fixed: Enhanced tracking with real map and analytics
        function updateTracking() {
            const trackingContent = document.getElementById('tracking-content');
            const noTreesMessage = document.getElementById('no-trees-message');
            
            if (appState.userData.treesPlanted === 0) {
                trackingContent.style.display = 'none';
                noTreesMessage.style.display = 'block';
                return;
            }
            
            trackingContent.style.display = 'block';
            noTreesMessage.style.display = 'none';
            
            initializeMapboxMap();
            initializeCharts();
            updateAchievementBadges();
        }

        // Fixed: Initialize Mapbox map with proper API key
        function initializeMapboxMap() {
            const mapContainer = document.getElementById('map');
            
            // Clear existing map
            mapContainer.innerHTML = '';
            
            // Create Mapbox map
            mapContainer.innerHTML = `
                <div id="mapbox-map" style="width: 100%; height: 100%;"></div>
            `;

            // Initialize map with Mapbox tiles
            const map = L.map('mapbox-map').setView([20.5937, 78.9629], 5);
            
            // Add Mapbox tile layer
            L.tileLayer(`https://api.mapbox.com/styles/v1/mapbox/satellite-streets-v12/tiles/{z}/{x}/{y}?access_token=${MAPBOX_API_KEY}`, {
                attribution: '© Mapbox © OpenStreetMap',
                maxZoom: 18,
                tileSize: 512,
                zoomOffset: -1
            }).addTo(map);

            // Enhanced tree locations with more variety
            const treeLocations = [
                { lat: 19.7515, lng: 75.7139, name: "Maharashtra Reforestation Site", trees: Math.ceil(appState.userData.treesPlanted * 0.3), species: "Teak, Neem" },
                { lat: 10.8505, lng: 76.2711, name: "Kerala Tropical Plantation", trees: Math.ceil(appState.userData.treesPlanted * 0.25), species: "Mango, Coconut" },
                { lat: 31.1048, lng: 77.1734, name: "Himachal Cold Climate Site", trees: Math.ceil(appState.userData.treesPlanted * 0.2), species: "Pine, Fir" },
                { lat: 26.9124, lng: 75.7873, name: "Rajasthan Arid Zone Project", trees: Math.ceil(appState.userData.treesPlanted * 0.15), species: "Neem, Acacia" },
                { lat: 22.5726, lng: 88.3639, name: "West Bengal Community Forest", trees: Math.ceil(appState.userData.treesPlanted * 0.1), species: "Banyan, Bamboo" }
            ];

            treeLocations.forEach(location => {
                if (location.trees > 0) {
                    // Create custom icon
                    const customIcon = L.divIcon({
                        className: 'custom-marker',
                        html: `<div style="background: linear-gradient(135deg, #4a7c2a, #6ba644); color: white; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; box-shadow: 0 4px 12px rgba(0,0,0,0.3);"><i class="fas fa-tree"></i></div>`,
                        iconSize: [40, 40],
                        iconAnchor: [20, 20]
                    });

                    const marker = L.marker([location.lat, location.lng], { icon: customIcon })
                        .addTo(map)
                        .bindPopup(`
                            <div style="font-family: 'Inter', sans-serif; padding: 10px; min-width: 200px;">
                                <h4 style="color: #2d5016; margin-bottom: 8px;">${location.name}</h4>
                                <div style="margin: 5px 0;"><strong>🌳 Trees:</strong> ${location.trees}</div>
                                <div style="margin: 5px 0;"><strong>🌿 Species:</strong> ${location.species}</div>
                                <div style="margin: 5px 0;"><strong>📅 Status:</strong> <span style="color: #4a7c2a;">Active Growth</span></div>
                                <div style="margin: 8px 0; padding: 5px; background: rgba(74, 124, 42, 0.1); border-radius: 5px; font-size: 0.9rem;">
                                    <strong>Impact:</strong> ${(location.trees * 45).toFixed(0)} kg CO2/year
                                </div>
                            </div>
                        `);

                    // Add growth animation on hover
                    marker.on('mouseover', function() {
                        this.getElement().style.transform = 'scale(1.2)';
                        this.getElement().style.transition = 'transform 0.3s ease';
                    });

                    marker.on('mouseout', function() {
                        this.getElement().style.transform = 'scale(1)';
                    });
                }
            });

            // Add legend
            const legend = L.control({position: 'bottomright'});
            legend.onAdd = function() {
                const div = L.DomUtil.create('div', 'legend');
                div.innerHTML = `
                    <div style="background: rgba(255, 255, 255, 0.95); padding: 15px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); backdrop-filter: blur(10px);">
                        <h4 style="margin: 0 0 10px 0; color: #2d5016;">Tree Planting Sites</h4>
                        <div style="display: flex; align-items: center; margin: 5px 0;">
                            <div style="width: 20px; height: 20px; background: linear-gradient(135deg, #4a7c2a, #6ba644); border-radius: 50%; margin-right: 8px;"></div>
                            <span style="font-size: 0.9rem;">Active Planting Site</span>
                        </div>
                        <div style="font-size: 0.8rem; color: #666; margin-top: 8px;">Total: ${appState.userData.treesPlanted} trees planted</div>
                    </div>
                `;
                return div;
            };
            legend.addTo(map);
        }

        // Fixed: Enhanced charts with real data
        function initializeCharts() {
            const ctx = document.getElementById('progressChart');
            if (!ctx) return;
            
            const chartCtx = ctx.getContext('2d');
            
            // Generate realistic progress data
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const currentMonth = new Date().getMonth();
            const displayMonths = months.slice(0, currentMonth + 1);
            
            const totalTrees = appState.userData.treesPlanted;
            const cumulativeData = [];
            const monthlyData = [];
            const co2Data = [];
            
            for (let i = 0; i <= currentMonth; i++) {
                const progress = (i + 1) / (currentMonth + 1);
                const seasonalMultiplier = 1 + 0.3 * Math.sin((i / 12) * 2 * Math.PI);
                const randomVariation = 0.8 + Math.random() * 0.4;
                
                const monthlyTrees = Math.round((totalTrees * progress * seasonalMultiplier * randomVariation) / (currentMonth + 1));
                const cumulativeTrees = Math.round(totalTrees * progress);
                const co2Offset = cumulativeTrees * 45;
                
                monthlyData.push(monthlyTrees);
                cumulativeData.push(cumulativeTrees);
                co2Data.push(co2Offset);
            }
            
            if (window.progressChart) {
                window.progressChart.destroy();
            }
            
            window.progressChart = new Chart(chartCtx, {
                type: 'line',
                data: {
                    labels: displayMonths,
                    datasets: [{
                        label: 'Cumulative Trees Planted',
                        data: cumulativeData,
                        borderColor: '#4a7c2a',
                        backgroundColor: 'rgba(74, 124, 42, 0.15)',
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#4a7c2a',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 3,
                        pointRadius: 7,
                        pointHoverRadius: 10
                    }, {
                        label: 'Monthly Planting Rate',
                        data: monthlyData,
                        borderColor: '#6ba644',
                        backgroundColor: 'rgba(107, 166, 68, 0.2)',
                        tension: 0.3,
                        fill: false,
                        pointBackgroundColor: '#6ba644',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        borderDash: [8, 4]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Tree Planting Progress & Growth Analytics',
                            font: { size: 18, weight: 'bold' },
                            color: '#2d5016'
                        },
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 25,
                                font: { size: 12 }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Trees',
                                color: '#2d5016',
                                font: { weight: 'bold', size: 14 }
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Month (2024)',
                                color: '#2d5016',
                                font: { weight: 'bold', size: 14 }
                            }
                        }
                    }
                }
            });
            
            createCO2Chart(displayMonths, co2Data);
            createSpeciesChart();
        }

        // Enhanced CO2 impact chart
        function createCO2Chart(months, co2Data) {
            const co2Canvas = document.getElementById('co2Chart');
            if (!co2Canvas) return;
            
            const ctx = co2Canvas.getContext('2d');
            
            if (window.co2Chart) {
                window.co2Chart.destroy();
            }
            
            window.co2Chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'CO2 Offset (kg/year)',
                        data: co2Data,
                        backgroundColor: 'rgba(107, 166, 68, 0.8)',
                        borderColor: '#6ba644',
                        borderWidth: 2,
                        borderRadius: 8,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Monthly CO2 Impact Analysis',
                            font: { size: 16, weight: 'bold' },
                            color: '#2d5016'
                        },
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'CO2 Offset (kg)',
                                color: '#2d5016'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Month',
                                color: '#2d5016'
                            }
                        }
                    }
                }
            });
        }

        // Enhanced species chart
        function createSpeciesChart() {
            const speciesCanvas = document.getElementById('speciesChart');
            if (!speciesCanvas) return;
            
            const ctx = speciesCanvas.getContext('2d');
            
            const speciesCount = {};
            appState.userData.certificates.forEach(cert => {
                cert.species.forEach(species => {
                    speciesCount[species] = (speciesCount[species] || 0) + 1;
                });
            });
            
            if (Object.keys(speciesCount).length === 0) {
                // Show placeholder chart if no data
                if (window.speciesChart) {
                    window.speciesChart.destroy();
                }
                return;
            }
            
            if (window.speciesChart) {
                window.speciesChart.destroy();
            }
            
            const colors = ['#4a7c2a', '#6ba644', '#8bc34a', '#aed581', '#c5e1a5', '#dcedc8'];
            
            window.speciesChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(speciesCount),
                    datasets: [{
                        data: Object.values(speciesCount),
                        backgroundColor: colors.slice(0, Object.keys(speciesCount).length),
                        borderColor: '#fff',
                        borderWidth: 4,
                        hoverBorderWidth: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Tree Species Distribution',
                            font: { size: 16, weight: 'bold' },
                            color: '#2d5016'
                        },
                        legend: {
                            position: 'bottom',
                            labels: {
                                usePointStyle: true,
                                padding: 20,
                                font: { size: 12 }
                            }
                        }
                    }
                }
            });
        }

        // Enhanced achievement system
        function updateAchievementBadges() {
            const trees = appState.userData.treesPlanted;
            const certificates = appState.userData.certificates.length;
            const badgesContainer = document.getElementById('badges-container');
            
            if (!badgesContainer) return;
            
            const achievements = [
                { name: 'First Steps', icon: '🌱', condition: trees >= 1, description: 'Planted your first tree' },
                { name: 'Green Thumb', icon: '👍', condition: trees >= 5, description: 'Planted 5 trees' },
                { name: 'Tree Hugger', icon: '🤗', condition: trees >= 10, description: 'Planted 10 trees' },
                { name: 'Forest Friend', icon: '🌲', condition: trees >= 25, description: 'Planted 25 trees' },
                { name: 'Climate Hero', icon: '🦸', condition: trees >= 50, description: 'Planted 50 trees' },
                { name: 'Carbon Warrior', icon: '⚔️', condition: trees >= 100, description: 'Planted 100 trees' },
                { name: 'Certificate Pro', icon: '🏆', condition: certificates >= 3, description: 'Earned 3 certificates' },
                { name: 'Eco Champion', icon: '👑', condition: trees >= 200, description: 'Planted 200 trees' }
            ];
            
            badgesContainer.innerHTML = '';
            
            achievements.forEach(achievement => {
                const badge = document.createElement('div');
                badge.className = achievement.condition ? 'achievement-badge' : 'achievement-badge locked';
                
                badge.innerHTML = `
                    <div style="font-size: 2.5rem; margin-bottom: 0.8rem;">${achievement.icon}</div>
                    <h4 style="margin: 0.8rem 0; font-size: 1rem; font-weight: 600;">${achievement.name}</h4>
                    <p style="margin: 0; font-size: 0.8rem; opacity: 0.9;">${achievement.description}</p>
                `;
                
                if (achievement.condition) {
                    badge.addEventListener('click', () => {
                        showAlert('success', `🎉 Achievement Unlocked: ${achievement.name}!`);
                    });
                }
                
                badgesContainer.appendChild(badge);
            });
        }

        // Fixed: PDF certificate generation with proper landscape format
        function downloadCertificatePDF(index) {
            const cert = appState.userData.certificates[index];
            
            // Check if jsPDF is available
            if (typeof window.jspdf === 'undefined') {
                showAlert('error', 'PDF library not loaded. Please refresh the page and try again.');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            
            showAlert('info', 'Generating certificate PDF...');
            
            try {
                const doc = new jsPDF({
                    orientation: 'landscape',
                    unit: 'mm',
                    format: 'a4'
                });
                
                // Enhanced certificate design
                const pageWidth = 297;
                const pageHeight = 210;
                
                // Background gradient simulation
                doc.setFillColor(232, 245, 232);
                doc.rect(0, 0, pageWidth, pageHeight, 'F');
                
                // Decorative border
                doc.setDrawColor(255, 215, 0);
                doc.setLineWidth(4);
                doc.rect(10, 10, pageWidth - 20, pageHeight - 20);
                doc.setLineWidth(2);
                doc.rect(15, 15, pageWidth - 30, pageHeight - 30);
                
                // Header section
                doc.setTextColor(45, 80, 22);
                doc.setFontSize(32);
                doc.setFont('helvetica', 'bold');
                doc.text('🌱 CERTIFICATE OF APPRECIATION 🌱', pageWidth/2, 40, { align: 'center' });
                
                // Subtitle
                doc.setFontSize(16);
                doc.setFont('helvetica', 'italic');
                doc.setTextColor(100, 100, 100);
                doc.text('This is to certify that,', pageWidth/2, 55, { align: 'center' });
                
                // Name placeholder
                doc.setFontSize(36);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(255, 215, 0);
                doc.text('Thank You!!', pageWidth/2, 75, { align: 'center' });
                
                // Main text
                doc.setTextColor(45, 80, 22);
                doc.setFontSize(18);
                doc.setFont('helvetica', 'normal');
                doc.text('You have contributed to environmental sustainability by planting', pageWidth/2, 90, { align: 'center' });
                
                // Main achievement
                doc.setFontSize(48);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(74, 124, 42);
                doc.text(`${cert.trees} Trees`, pageWidth/2, 115, { align: 'center' });
                
                doc.setFontSize(24);
                doc.setTextColor(107, 166, 68);
                doc.text(`${Math.round(cert.co2Offset)} kg CO2 Offset`, pageWidth/2, 130, { align: 'center' });
                
                // Footer message
                doc.setFontSize(16);
                doc.setTextColor(45, 80, 22);
                doc.text('Thank you for sowing the seeds of a greener tomorrow.', pageWidth/2, 145, { align: 'center' });
                
                // Signature section
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text('EcoSync AI', 70, 170, { align: 'center' });
                doc.setFont('helvetica', 'normal');
                doc.text('Platform', 70, 178, { align: 'center' });
                
                doc.setFont('helvetica', 'bold');
                doc.text('Verified Authority', 227, 170, { align: 'center' });
                doc.setFont('helvetica', 'normal');
                doc.text('Environmental Board', 227, 178, { align: 'center' });
                
                // Certificate details
                doc.setFontSize(12);
                doc.setTextColor(100, 100, 100);
                doc.text(`Certificate ID: ECOSYNC-${cert.id}`, pageWidth/2, 190, { align: 'center' });
                doc.text(`Issue Date: ${new Date(cert.date).toLocaleDateString()}`, pageWidth/2, 198, { align: 'center' });
                
                const fileName = `EcoSync_Certificate_${cert.trees}Trees_${cert.date}.pdf`;
                doc.save(fileName);
                
                showAlert('success', `🎉 Certificate downloaded successfully! ${fileName}`);
            } catch (error) {
                console.error('PDF generation error:', error);
                showAlert('error', 'Error generating PDF. Please try again.');
            }
        }

        // Enhanced social sharing
        function shareToSocial(platform, certificateIndex) {
            const cert = appState.userData.certificates[certificateIndex];
            const message = `🌱 I just planted ${cert.trees} trees and offset ${Math.round(cert.co2Offset)}kg of CO2 with EcoSync AI! 🌍 Join me in fighting climate change. #EcoSyncAI #ClimateAction #TreePlanting #CarbonNeutral`;
            
            let url;
            switch(platform) {
                case 'twitter':
                    url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(message)}`;
                    break;
                case 'facebook':
                    url = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}&quote=${encodeURIComponent(message)}`;
                    break;
                case 'linkedin':
                    url = `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(window.location.href)}`;
                    break;
                default:
                    return;
            }
            
            window.open(url, '_blank', 'width=600,height=400');
            showAlert('success', 'Share window opened! Spread the green message! 🌱');
        }

        // Enhanced demo data loader
        function loadDemoData() {
            appState.userData.treesPlanted = 75;
            appState.userData.totalEmissions = 850.0;
            appState.userData.forestArea = 1125.0;
            appState.userData.totalCO2Offset = 3375.0; // 75 trees * 45 kg CO2 avg
            
            const demoCerts = [
                {
                    date: '2024-06-15',
                    trees: 25,
                    co2Offset: 1125.0,
                    cost: 625,
                    species: ['Oak', 'Pine', 'Maple'],
                    method: 'Sponsor local farmers',
                    payment: 'Credit Card',
                    id: Date.now() - 1000000
                },
                {
                    date: '2024-07-20',
                    trees: 30,
                    co2Offset: 1350.0,
                    cost: 750,
                    species: ['Mango', 'Neem', 'Banyan'],
                    method: 'Community initiative',
                    payment: 'PayPal',
                    id: Date.now() - 500000
                },
                {
                    date: '2024-08-01',
                    trees: 20,
                    co2Offset: 900.0,
                    cost: 400,
                    species: ['Eucalyptus', 'Acacia'],
                    method: 'AI Auto-Selection',
                    payment: 'Crypto',
                    id: Date.now()
                }
            ];
            
            appState.userData.certificates = demoCerts;
            
            updateCertificates();
            updateAllMetrics();
            updateTracking();
            
            showAlert('success', '🎉 Demo data loaded! Check all tabs to see the features in action.');
        }

        // Enhanced reset function
        function resetData() {
            if (confirm('Are you sure you want to reset all data? This cannot be undone.')) {
                appState.userData = {
                    totalEmissions: 0,
                    treesPlanted: 0,
                    certificates: [],
                    forestArea: 0,
                    totalCO2Offset: 0
                };
                appState.calculatedEmissions = 0;
                appState.selectedTrees = {};
                
                // Destroy existing charts
                if (window.progressChart) window.progressChart.destroy();
                if (window.co2Chart) window.co2Chart.destroy();
                if (window.speciesChart) window.speciesChart.destroy();
                
                updateCertificates();
                updateAllMetrics();
                updateTracking();
                
                // Reset form values
                document.getElementById('transport').value = 'Flight (Domestic)';
                document.getElementById('distance').value = '500';
                document.getElementById('duration').value = '5';
                document.getElementById('people').value = '2';
                document.getElementById('accommodation').value = 'Luxury Hotel';
                document.getElementById('manual-emissions').value = '100';
                document.getElementById('region').value = 'Tropical';
                
                // Reset displays
                document.getElementById('transport-emissions').textContent = 'Transport: 0 kg CO2';
                document.getElementById('accommodation-emissions').textContent = 'Accommodation: 0 kg CO2';
                document.getElementById('total-emissions').textContent = 'Total Emissions: 0 kg CO2';
                document.getElementById('calculation-alert').style.display = 'none';
                document.getElementById('emissions-display').style.display = 'none';
                
                showAlert('info', '🔄 All data has been reset successfully!');
            }
        }

        // Enhanced alert system
        function showAlert(type, message) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.style.cssText = `
                position: fixed;
                top: 30px;
                right: 30px;
                z-index: 10000;
                max-width: 400px;
                padding: 1.5rem;
                border-radius: 15px;
                box-shadow: 0 15px 35px rgba(0,0,0,0.2);
                backdrop-filter: blur(15px);
                border: 2px solid ${type === 'success' ? 'rgba(21, 87, 36, 0.3)' : type === 'error' ? 'rgba(220, 53, 69, 0.3)' : 'rgba(0, 64, 133, 0.3)'};
                background: ${type === 'success' ? 'rgba(212, 237, 218, 0.95)' : type === 'error' ? 'rgba(248, 215, 218, 0.95)' : 'rgba(204, 231, 255, 0.95)'};
                color: ${type === 'success' ? '#155724' : type === 'error' ? '#721c24' : '#004085'};
                font-weight: 500;
                transform: translateX(450px);
                transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            `;
            
            const iconClass = type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-triangle' : 'fa-info-circle';
            
            alertDiv.innerHTML = `
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <i class="fas ${iconClass}" style="font-size: 1.5rem;"></i>
                    <div style="flex: 1;">${message}</div>
                    <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; font-size: 1.2rem; cursor: pointer; opacity: 0.7; padding: 0.2rem;">×</button>
                </div>
            `;
            
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                alertDiv.style.transform = 'translateX(0)';
            }, 100);
            
            setTimeout(() => {
                if (alertDiv.parentElement) {
                    alertDiv.style.transform = 'translateX(450px)';
                    setTimeout(() => alertDiv.remove(), 400);
                }
            }, 5000);
        }

        // Enhanced tree planting animation
        function animateTreePlanting() {
            const trees = ['🌱', '🌿', '🌳', '🍃', '🌲', '🎋'];
            const container = document.body;
            
            for (let i = 0; i < 15; i++) {
                setTimeout(() => {
                    const treeEmoji = document.createElement('div');
                    treeEmoji.textContent = trees[Math.floor(Math.random() * trees.length)];
                    treeEmoji.style.cssText = `
                        position: fixed;
                        left: ${Math.random() * window.innerWidth}px;
                        top: ${window.innerHeight + 50}px;
                        font-size: ${1.5 + Math.random() * 1.5}rem;
                        z-index: 9999;
                        pointer-events: none;
                        transition: all 4s cubic-bezier(0.4, 0, 0.2, 1);
                        opacity: 0.9;
                    `;
                    
                    container.appendChild(treeEmoji);
                    
                    setTimeout(() => {
                        treeEmoji.style.top = '-100px';
                        treeEmoji.style.transform = `rotate(${360 + Math.random() * 360}deg) scale(${0.5 + Math.random() * 0.5})`;
                        treeEmoji.style.opacity = '0';
                    }, 100);
                    
                    setTimeout(() => {
                        if (treeEmoji.parentElement) {
                            treeEmoji.remove();
                        }
                    }, 4000);
                }, i * 150);
            }
        }

        // Enhanced planting progress animation
        function showPlantingProgress() {
            const progressDiv = document.createElement('div');
            progressDiv.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
                backdrop-filter: blur(5px);
            `;
            
            progressDiv.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(248, 249, 250, 0.95));
                    padding: 3rem;
                    border-radius: 25px;
                    text-align: center;
                    min-width: 400px;
                    box-shadow: 0 25px 50px rgba(0,0,0,0.3);
                    backdrop-filter: blur(20px);
                    border: 2px solid rgba(74, 124, 42, 0.3);
                ">
                    <div style="font-size: 4rem; margin-bottom: 1.5rem; animation: bounce 1s infinite;">🌱</div>
                    <h3 style="color: #2d5016; margin-bottom: 1.5rem; font-size: 1.8rem;">Planting Your Trees...</h3>
                    <div style="
                        width: 100%;
                        height: 12px;
                        background: rgba(233, 236, 239, 0.8);
                        border-radius: 6px;
                        overflow: hidden;
                        margin: 1.5rem 0;
                    ">
                        <div id="progress-bar" style="
                            height: 100%;
                            background: linear-gradient(90deg, #4a7c2a, #6ba644, #8bc34a);
                            width: 0%;
                            transition: width 2s cubic-bezier(0.4, 0, 0.2, 1);
                            border-radius: 6px;
                        "></div>
                    </div>
                    <p style="margin-top: 1rem; color: #666; font-size: 1.1rem;">
                        Connecting with planting partners and selecting optimal locations...
                    </p>
                    <div style="display: flex; justify-content: center; gap: 0.5rem; margin-top: 1.5rem;">
                        <div class="loading" style="animation-delay: 0s;"></div>
                        <div class="loading" style="animation-delay: 0.2s;"></div>
                        <div class="loading" style="animation-delay: 0.4s;"></div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(progressDiv);
            
            setTimeout(() => {
                document.getElementById('progress-bar').style.width = '100%';
            }, 200);
            
            setTimeout(() => {
                progressDiv.remove();
            }, 2500);
        }

        // Scroll to top function
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // Enhanced auto-calculation on input change
        function setupAutoCalculation() {
            const inputs = ['transport', 'distance', 'duration', 'people', 'accommodation'];
            inputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', function() {
                        const transport = document.getElementById('transport').value;
                        const distance = parseFloat(document.getElementById('distance').value) || 0;
                        const duration = parseInt(document.getElementById('duration').value) || 0;
                        const people = parseInt(document.getElementById('people').value) || 1;
                        const accommodation = document.getElementById('accommodation').value;

                        const transportEmissions = distance * (emissionFactors[transport] || 0.2) * people;
                        const accommodationEmissions = duration * (accommodationFactors[accommodation] || 30) * people;
                        const totalEmissions = transportEmissions + accommodationEmissions;

                        document.getElementById('transport-emissions').textContent = `Transport: ${transportEmissions.toFixed(1)} kg CO2`;
                        document.getElementById('accommodation-emissions').textContent = `Accommodation: ${accommodationEmissions.toFixed(1)} kg CO2`;
                        document.getElementById('total-emissions').textContent = `Total Emissions: ${totalEmissions.toFixed(1)} kg CO2`;
                        
                        appState.calculatedEmissions = totalEmissions;
                        appState.userData.totalEmissions = totalEmissions;
                    });
                }
            });
        }

        // Enhanced manual emissions input handler
        function setupManualEmissionsHandler() {
            const manualEmissionsInput = document.getElementById('manual-emissions');
            if (manualEmissionsInput) {
                manualEmissionsInput.addEventListener('input', function() {
                    filterTrees();
                });
            }
        }

        // Keyboard shortcuts
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key) {
                        case '1':
                            e.preventDefault();
                            document.querySelector('[onclick*="calculate"]').click();
                            break;
                        case '2':
                            e.preventDefault();
                            document.querySelector('[onclick*="plant"]').click();
                            break;
                        case '3':
                            e.preventDefault();
                            document.querySelector('[onclick*="track"]').click();
                            break;
                        case '4':
                            e.preventDefault();
                            document.querySelector('[onclick*="certificates"]').click();
                            break;
                        case 'r':
                            e.preventDefault();
                            resetData();
                            break;
                        case 'd':
                            e.preventDefault();
                            loadDemoData();
                            break;
                    }
                }
            });
        }

        // Add tooltips for better UX
        function addTooltips() {
            const tooltips = {
                'transport': 'Different transport modes have varying CO2 emissions per kilometer',
                'distance': 'Total distance of your journey in kilometers',
                'duration': 'Number of days you will stay at your destination',
                'people': 'Total number of people traveling (affects total emissions)',
                'accommodation': 'Hotel type affects daily CO2 emissions from energy usage',
                'region': 'Select the climate region for optimal tree species selection',
                'manual-emissions': 'Enter the amount of CO2 you want to offset in kilograms'
            };
            
            Object.entries(tooltips).forEach(([id, text]) => {
                const element = document.getElementById(id);
                if (element) {
                    element.title = text;
                    element.style.cursor = 'help';
                }
            });
        }

        // Enhanced initialization
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🌱 EcoSync AI Enhanced Version Loading...');
            
            // Initialize all components
            setupAutoCalculation();
            setupManualEmissionsHandler();
            setupKeyboardShortcuts();
            addTooltips();
            
            // Initial data setup
            filterTrees();
            updateCertificates();
            updateAllMetrics();
            updateTracking();
            
            // Welcome animation
            setTimeout(() => {
                const header = document.querySelector('.main-header');
                header.style.transform = 'scale(1.02)';
                setTimeout(() => {
                    header.style.transform = 'scale(1)';
                }, 300);
            }, 500);
            
            // Show welcome message with instructions
            setTimeout(() => {
                showAlert('info', '🌍 Welcome to EcoSync AI! Use Ctrl+D for demo data or start calculating your emissions. All tracking features are now working!');
            }, 1000);
            
            console.log('🌳 EcoSync AI Enhanced Version loaded successfully!');
            console.log('📊 Features: Fixed Tracking, Mapbox Integration, Working PDF Downloads, Real-time Metrics');
            console.log('⌨️  Shortcuts: Ctrl+1-4 (tabs), Ctrl+R (reset), Ctrl+D (demo)');
        });
    </script>
</body>
</html>